<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .state { fill: #3498db; stroke: #2c3e50; stroke-width: 2; }
      .state-text { font-family: Arial; font-size: 13px; font-weight: bold; fill: white; text-anchor: middle; }
      .transition { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .label { font-family: Arial; font-size: 11px; fill: #2c3e50; }
      .final-state { fill: #27ae60; stroke: #2c3e50; stroke-width: 2; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" style="font-family: Arial; font-size: 18px; font-weight: bold; fill: #2c3e50;">Cursor State Machine</text>
  
  <!-- Initial State -->
  <circle cx="100" cy="100" r="35" class="state"/>
  <text x="100" y="105" class="state-text">INITIAL</text>
  <text x="100" y="150" class="label">(cursor = null)</text>
  
  <!-- Page Loaded State -->
  <rect x="280" y="65" width="140" height="70" rx="10" class="state"/>
  <text x="350" y="95" class="state-text">PAGE_LOADED</text>
  <text x="350" y="115" class="state-text" font-size="11">(has messages)</text>
  
  <!-- Has More State -->
  <rect x="280" y="200" width="140" height="70" rx="10" class="state"/>
  <text x="350" y="230" class="state-text">HAS_MORE</text>
  <text x="350" y="250" class="state-text" font-size="11">(nextCursor != null)</text>
  
  <!-- Last Page State -->
  <rect x="280" y="335" width="140" height="70" rx="10" class="final-state"/>
  <text x="350" y="365" class="state-text">LAST_PAGE</text>
  <text x="350" y="385" class="state-text" font-size="11">(hasMore = false)</text>
  
  <!-- Seeking Forward -->
  <rect x="520" y="200" width="140" height="70" rx="10" class="state"/>
  <text x="590" y="230" class="state-text">SEEKING_FWD</text>
  <text x="590" y="250" class="state-text" font-size="11">(loading next)</text>
  
  <!-- Seeking Backward -->
  <rect x="520" y="65" width="140" height="70" rx="10" class="state"/>
  <text x="590" y="95" class="state-text">SEEKING_BACK</text>
  <text x="590" y="115" class="state-text" font-size="11">(loading prev)</text>
  
  <!-- Transitions -->
  
  <!-- INITIAL -> PAGE_LOADED -->
  <path d="M 135 100 L 280 100" class="transition"/>
  <text x="207" y="95" class="label">Load Initial Page</text>
  <text x="207" y="108" class="label">cursor = null, limit = 50</text>
  
  <!-- PAGE_LOADED -> HAS_MORE -->
  <path d="M 350 135 L 350 200" class="transition"/>
  <text x="365" y="172" class="label">Check hasMore</text>
  
  <!-- HAS_MORE -> SEEKING_FWD -->
  <path d="M 420 235 L 520 235" class="transition"/>
  <text x="470" y="230" class="label">Click "Next"</text>
  <text x="470" y="243" class="label">cursor = nextCursor</text>
  
  <!-- SEEKING_FWD -> PAGE_LOADED -->
  <path d="M 590 200 Q 590 150 420 100" class="transition"/>
  <text x="510" y="145" class="label">Query Complete</text>
  
  <!-- PAGE_LOADED -> SEEKING_BACK -->
  <path d="M 420 100 L 520 100" class="transition"/>
  <text x="470" y="95" class="label">Click "Previous"</text>
  <text x="470" y="108" class="label">cursor = prevCursor</text>
  
  <!-- SEEKING_BACK -> PAGE_LOADED -->
  <path d="M 520 100 L 420 100" class="transition" stroke-dasharray="5,5"/>
  <text x="470" y="120" class="label">Query Complete</text>
  
  <!-- HAS_MORE -> LAST_PAGE -->
  <path d="M 350 270 L 350 335" class="transition"/>
  <text x="365" y="307" class="label">hasMore = false</text>
  
  <!-- Notes -->
  <rect x="50" y="450" width="700" height="130" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1"/>
  <text x="60" y="475" class="label" font-weight="bold" font-size="13">Cursor Encoding Format:</text>
  <text x="60" y="495" class="label">cursor = base64(message_id:1234567890|timestamp:2025-02-07T10:00:00Z)</text>
  
  <text x="60" y="520" class="label" font-weight="bold" font-size="13">State Transitions:</text>
  <text x="60" y="538" class="label">• INITIAL: User opens chat history (cursor = null)</text>
  <text x="60" y="553" class="label">• PAGE_LOADED: Messages rendered, evaluate hasMore flag</text>
  <text x="60" y="568" class="label">• SEEKING_FWD/BACK: Virtual Thread executes Cassandra query with cursor</text>
</svg>
