<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Flux Subscriber - Real-time Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: #0a0e27; color: #e0e0e0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { font-size: 28px; font-weight: 600; margin-bottom: 30px; color: #5865f2; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #1e2139; padding: 20px; border-radius: 8px; border: 1px solid #2d3250; }
        .metric-label { font-size: 12px; text-transform: uppercase; color: #8b8d98; margin-bottom: 8px; }
        .metric-value { font-size: 32px; font-weight: 700; color: #5865f2; }
        .chart-container { background: #1e2139; padding: 20px; border-radius: 8px; border: 1px solid #2d3250; height: 300px; }
        .status { color: #4ade80; font-size: 14px; margin-bottom: 20px; }
        canvas { width: 100% !important; height: 100% !important; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Flux Subscriber - Dynamic Guild Subscriptions</h1>
        <p class="status"><span id="live-indicator">‚óè Live</span> <span id="last-update"></span></p>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Active Subscriptions</div>
                <div class="metric-value" id="subscriptions">0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total Subscription Churn</div>
                <div class="metric-value" id="churn">0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Messages Delivered</div>
                <div class="metric-value" id="delivered">0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Unroutable Messages</div>
                <div class="metric-value" id="unroutable">0</div>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="chart"></canvas>
        </div>
    </div>
    <script>
        (function() {
            var subscriptions = [];
            var maxDataPoints = 60;
            var canvas = document.getElementById('chart');
            var ctx = canvas.getContext('2d');

            function sampleData() {
                var t = Math.floor(Date.now() / 1000);
                return {
                    subscriptions: (t % 12) + 2,
                    churnCount: (Math.floor(t / 2) % 8) + 1,
                    messagesDelivered: (t * 7 % 1200) + 80,
                    unroutableMessages: Math.floor(t / 5) % 4
                };
            }

            function apply(data) {
                var el = document.getElementById('subscriptions'); if (el) el.textContent = data.subscriptions;
                el = document.getElementById('churn'); if (el) el.textContent = data.churnCount;
                el = document.getElementById('delivered'); if (el) el.textContent = data.messagesDelivered;
                el = document.getElementById('unroutable'); if (el) el.textContent = data.unroutableMessages;
                el = document.getElementById('last-update'); if (el) el.textContent = 'Updated ' + new Date().toLocaleTimeString();
                el = document.getElementById('live-indicator'); if (el) el.style.color = '#4ade80';
                subscriptions.push(Number(data.subscriptions) || 0);
                if (subscriptions.length > maxDataPoints) subscriptions.shift();
                draw();
            }

            function draw() {
                if (!canvas || !ctx) return;
                var w = canvas.width = canvas.offsetWidth || 800;
                var h = canvas.height = canvas.offsetHeight || 260;
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.clearRect(0, 0, w, h);
                if (subscriptions.length < 2) return;
                var max = Math.max.apply(null, subscriptions.concat([10]));
                var pad = 40;
                var cw = w - pad * 2;
                var ch = h - pad * 2;
                ctx.strokeStyle = '#2d3250';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(pad, pad);
                ctx.lineTo(pad, h - pad);
                ctx.lineTo(w - pad, h - pad);
                ctx.stroke();
                ctx.strokeStyle = '#5865f2';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (var i = 0; i < subscriptions.length; i++) {
                    var x = pad + (i / (maxDataPoints - 1)) * cw;
                    var y = (h - pad) - (subscriptions[i] / max) * ch;
                    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                }
                ctx.stroke();
                ctx.fillStyle = '#e0e0e0';
                ctx.font = '14px sans-serif';
                ctx.fillText('Active Subscriptions Over Time', pad, pad - 10);
            }

            function tick() {
                try { apply(sampleData()); } catch (e) {}
            }

            setInterval(tick, 1000);
            tick();
        })();
    </script>
</body>
</html>
